<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Catálogo com Controle de Estoque</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    .produto {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    .produto h2 {
      margin-top: 0;
    }
    label {
      display: inline-block;
      margin: 0 10px 10px 0;
      cursor: pointer;
    }
    select, input[type="number"] {
      padding: 5px;
      margin-left: 5px;
      width: 60px;
    }
    button {
      cursor: pointer;
      padding: 10px 15px;
      background: #007bff;
      border: none;
      color: white;
      border-radius: 4px;
      margin-top: 10px;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #0056b3;
    }
    #listaCompra {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      max-width: 800px;
      margin: 20px auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #007bff;
      color: white;
    }
    .btn-remover {
      background: #dc3545;
      border: none;
      padding: 5px 10px;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .btn-remover:hover {
      background: #a71d2a;
    }
    #graficos {
      max-width: 700px;
      margin: 40px auto;
      display: flex;
      justify-content: space-around;
      gap: 30px;
    }
    canvas {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

  <h1>Catálogo Online</h1>

  <div id="catalogo">

    <!-- Produto 1 -->
    <div class="produto" data-produto-id="1" data-codigo="CAM001" data-nome="Camiseta Básica">
      <h2>Código: CAM001 - Camiseta Básica</h2>
      <p>Preço unitário: R$ 50,00</p>
      <p>Estoque disponível: <span class="estoque">10</span></p>
      <label>
        Cor:
        <select class="cor">
          <option value="">Selecione</option>
          <option value="Preto">Preto</option>
          <option value="Branco">Branco</option>
          <option value="Azul">Azul</option>
        </select>
      </label>
      <label>
        Tamanho:
        <select class="tamanho">
          <option value="">Selecione</option>
          <option value="P">P</option>
          <option value="M">M</option>
          <option value="G">G</option>
          <option value="GG">GG</option>
        </select>
      </label>
      <label>
        Quantidade:
        <input type="number" class="quantidade" min="1" value="1" />
      </label>
      <button class="btn-adicionar">Adicionar à lista</button>
    </div>

    <!-- Produto 2 -->
    <div class="produto" data-produto-id="2" data-codigo="CAL002" data-nome="Calça Jeans">
      <h2>Código: CAL002 - Calça Jeans</h2>
      <p>Preço unitário: R$ 120,00</p>
      <p>Estoque disponível: <span class="estoque">5</span></p>
      <label>
        Cor:
        <select class="cor">
          <option value="">Selecione</option>
          <option value="Azul Claro">Azul Claro</option>
          <option value="Azul Escuro">Azul Escuro</option>
          <option value="Preto">Preto</option>
        </select>
      </label>
      <label>
        Tamanho:
        <select class="tamanho">
          <option value="">Selecione</option>
          <option value="36">36</option>
          <option value="38">38</option>
          <option value="40">40</option>
          <option value="42">42</option>
        </select>
      </label>
      <label>
        Quantidade:
        <input type="number" class="quantidade" min="1" value="1" />
      </label>
      <button class="btn-adicionar">Adicionar à lista</button>
    </div>

  </div>

  <div id="listaCompra" style="display:none;">
    <h3>Lista de Compra (edite cores, tamanhos, quantidades ou remova itens)</h3>
    <table id="tabelaLista">
      <thead>
        <tr>
          <th>Código</th>
          <th>Produto</th>
          <th>Cor</th>
          <th>Tamanho</th>
          <th>Quantidade</th>
          <th>Preço Unit.</th>
          <th>Total</th>
          <th>Remover</th>
        </tr>
      </thead>
      <tbody>
        <!-- linhas vão aqui -->
      </tbody>
    </table>
    <button id="enviarWhatsappBtn" style="margin-top: 15px;">Enviar por WhatsApp</button>
  </div>

  <div id="graficos" style="display:none;">
    <canvas id="graficoCores" width="300" height="300"></canvas>
    <canvas id="graficoTamanhos" width="300" height="300"></canvas>
  </div>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // Produtos com estoque por produto (quantidade total, simplificado)
    const produtos = [
      {
        id: 1,
        codigo: 'CAM001',
        nome: 'Camiseta Básica',
        preco: 50.00,
        estoque: 10,
        cores: ['Preto', 'Branco', 'Azul'],
        tamanhos: ['P', 'M', 'G', 'GG'],
      },
      {
        id: 2,
        codigo: 'CAL002',
        nome: 'Calça Jeans',
        preco: 120.00,
        estoque: 5,
        cores: ['Azul Claro', 'Azul Escuro', 'Preto'],
        tamanhos: ['36', '38', '40', '42'],
      }
    ];

    const listaCompraDiv = document.getElementById('listaCompra');
    const tabelaLista = document.getElementById('tabelaLista').querySelector('tbody');
    const enviarWhatsappBtn = document.getElementById('enviarWhatsappBtn');
    const graficosDiv = document.getElementById('graficos');

    // Atualizar exibição do estoque na página
    function atualizarEstoqueNaPagina() {
      produtos.forEach(p => {
        const produtoDiv = [...document.querySelectorAll('.produto')].find(div => div.dataset.codigo === p.codigo);
        if (produtoDiv) {
          produtoDiv.querySelector('.estoque').textContent = p.estoque;
        }
      });
    }
    atualizarEstoqueNaPagina();

    // Adicionar evento aos botões "Adicionar à lista"
    document.querySelectorAll('.btn-adicionar').forEach(btn => {
      btn.addEventListener('click', () => {
        const produtoDiv = btn.closest('.produto');
        const codigo = produtoDiv.dataset.codigo;
        const nome = produtoDiv.dataset.nome;
        const produto = produtos.find(p => p.codigo === codigo);

        const cor = produtoDiv.querySelector('.cor').value;
        const tamanho = produtoDiv.querySelector('.tamanho').value;
        let quantidade = parseInt(produtoDiv.querySelector('.quantidade').value);

        if (!cor) {
          alert('Selecione a cor.');
          return;
        }
        if (!tamanho) {
          alert('Selecione o tamanho.');
          return;
        }
        if (!quantidade || quantidade < 1) {
          alert('Quantidade deve ser maior que zero.');
          return;
        }

        // Verifica estoque disponível para essa quantidade + já adicionada na lista
        const qtdNaLista = obterQuantidadeNaLista(codigo, cor, tamanho);
        if (quantidade + qtdNaLista > produto.estoque) {
          alert(`Quantidade indisponível no estoque. Estoque disponível: ${produto.estoque - qtdNaLista}`);
          return;
        }

        adicionarItemNaLista({codigo, nome, cor, tamanho, quantidade, preco: produto.preco});
        listaCompraDiv.style.display = 'block';
        graficosDiv.style.display = 'flex';
        atualizarGraficos();
      });
    });

    // Função para obter quantidade já adicionada na lista para o mesmo código + cor + tamanho
    function obterQuantidadeNaLista(codigo, cor, tamanho) {
      let soma = 0;
      for (const tr of tabelaLista.rows) {
        const codigoTd = tr.querySelector('.td-codigo').textContent;
        const corSelect = tr.querySelector('.select-cor').value;
        const tamanhoSelect = tr.querySelector('.select-tamanho').value;
        if (codigoTd === codigo && corSelect === cor && tamanhoSelect === tamanho) {
          soma += parseInt(tr.querySelector('.input-quantidade').value);
        }
      }
      return soma;
    }

    // Função para adicionar item na tabela
    function adicionarItemNaLista(item) {
      // Verifica se já existe um item com mesmo código, cor e tamanho — se sim, soma quantidade
      const linhas = Array.from(tabelaLista.querySelectorAll('tr'));
      for (const linha of linhas) {
        const codigoTd = linha.querySelector('.td-codigo').textContent;
        const corSelect = linha.querySelector('.select-cor');
        const tamanhoSelect = linha.querySelector('.select-tamanho');
        if (codigoTd === item.codigo && corSelect.value === item.cor && tamanhoSelect.value === item.tamanho) {
          // Atualiza quantidade (somando e respeitando estoque)
          let qtdAtual = parseInt(linha.querySelector('.input-quantidade').value);
          let novaQtd = qtdAtual + item.quantidade;

          const produto = produtos.find(p => p.codigo === item.codigo);
          if (novaQtd > produto.estoque) {
            alert(`Quantidade máxima no estoque para este item é ${produto.estoque}.`);
